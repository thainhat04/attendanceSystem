<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
    <h2>ğŸ” ÄÄƒng nháº­p Admin</h2>
    <button onclick="loginWithMetaMask()">ÄÄƒng nháº­p báº±ng MetaMask</button>

    <p id="errorMessage" style="color: red; display: none;">âŒ Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p!</p>

    <button id="backButton" onclick="location.href='role.html'">â¬… Quay láº¡i</button>
    
    <div id="adminPanel">
        <h3>ğŸ“Œ Danh sÃ¡ch lá»›p chá» duyá»‡t</h3>
        <ul id="pendingClassesList"></ul>
    </div>
    
    <script src="app.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            await loadPendingClasses(); // Táº£i danh sÃ¡ch lá»›p chá» duyá»‡t
        });
    </script>
    

    <script>
        async function loginWithMetaMask() {
            if (window.ethereum) {
                try {
                    const web3 = new Web3(window.ethereum);
                    await window.ethereum.request({ method: "eth_requestAccounts" });

                    const accounts = await web3.eth.getAccounts();
                    const userAddress = accounts[0]; // Láº¥y Ä‘á»‹a chá»‰ vÃ­ ngÆ°á»i dÃ¹ng

                    console.log("ğŸ”¹ Äá»‹a chá»‰ vÃ­:", userAddress);

                    // Danh sÃ¡ch Ä‘á»‹a chá»‰ admin (cÃ³ thá»ƒ thay Ä‘á»•i)
                    const adminAddress = "0x5F36E7A89be6B7DE697920892da6fB8E6c377FfA"; 

                    // YÃªu cáº§u kÃ½ tin nháº¯n
                    const message = "XÃ¡c thá»±c Ä‘Äƒng nháº­p Admin vÃ o há»‡ thá»‘ng Blockchain Attendance";
                    const signature = await web3.eth.personal.sign(message, userAddress, "");

                    console.log("âœ… KÃ½ thÃ nh cÃ´ng:", signature);

                    // Kiá»ƒm tra xem ngÆ°á»i dÃ¹ng cÃ³ pháº£i lÃ  Admin khÃ´ng
                    if (userAddress.toLowerCase() === adminAddress.toLowerCase()) {
                        window.location.href = "dashboard.html?role=admin";
                    } else {
                        document.getElementById("errorMessage").style.display = "block";
                    }
                } catch (error) {
                    console.error("âŒ Lá»—i khi Ä‘Äƒng nháº­p:", error);
                    document.getElementById("errorMessage").innerText = "Lá»—i khi káº¿t ná»‘i MetaMask!";
                    document.getElementById("errorMessage").style.display = "block";
                }
            } else {
                alert("âš ï¸ Báº¡n cáº§n cÃ i MetaMask Ä‘á»ƒ Ä‘Äƒng nháº­p!");
            }
        }
    </script>
</body>
</html>
